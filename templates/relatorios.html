{% extends "base.html" %}

{% block title %}Dashboard-TRONIK - Relatórios{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/relatorios.css') }}">
{% endblock %}

{% block content %}
<div class="relatorios-container">
    <!-- Left Panel -->
    <div class="relatorios-left-panel">
        <!-- Filtros -->
        <div class="card">
            <h3 class="card-header">Filtros do Relatório</h3>
            <div class="filters-compact">
                <div class="filter-group">
                    <div class="filter-label">Data Início</div>
                    <input type="date" id="data-inicio" class="filter-input">
                </div>
                <div class="filter-group">
                    <div class="filter-label">Data Fim</div>
                    <input type="date" id="data-fim" class="filter-input">
                </div>
                <div class="filter-group">
                    <div class="filter-label">Parceiro</div>
                    <select id="filtro-parceiro" class="filter-input">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <div class="filter-label">Tipo de Operação</div>
                    <select id="filtro-tipo-operacao" class="filter-input">
                        <option value="">Todos</option>
                        <option value="Avulsa">Avulsa</option>
                        <option value="Campanha">Campanha</option>
                    </select>
                </div>
                <button class="btn-primary" id="btn-aplicar-filtro" style="padding: 8px 16px; margin-top: 5px;">
                    Aplicar
                </button>
            </div>
        </div>

        <!-- Indicadores do Período -->
        <div class="card">
            <h3 class="card-header">Indicadores do Período</h3>
            <div class="kpi-grid-indicadores">
                <div class="kpi-card-indicador">
                    <div class="kpi-value-indicador" id="kpi-total-coletas">0</div>
                    <div class="kpi-label-indicador">Total Coletas</div>
                </div>
                <div class="kpi-card-indicador">
                    <div class="kpi-value-indicador" id="kpi-volume-total">0KG</div>
                    <div class="kpi-label-indicador">Volume Total</div>
                </div>
                <div class="kpi-card-indicador">
                    <div class="kpi-value-indicador" id="kpi-km-total">0km</div>
                    <div class="kpi-label-indicador">KM Total</div>
                </div>
                <div class="kpi-card-indicador">
                    <div class="kpi-value-indicador" id="kpi-lucro-total">R$ 0</div>
                    <div class="kpi-label-indicador">Lucro Total</div>
                </div>
                <div class="kpi-card-indicador">
                    <div class="kpi-value-indicador" id="kpi-lucro-medio">R$ 0</div>
                    <div class="kpi-label-indicador">Lucro Médio/Coleta</div>
                </div>
            </div>
        </div>

        <!-- Evolução de Coletas -->
        <div class="card">
            <div class="chart-header">
                <h3 class="chart-title">Evolução de Coletas</h3>
                <div class="chart-tabs">
                    <button class="tab-btn" data-periodo="7">7 dias</button>
                    <button class="tab-btn active" data-periodo="30">30 dias</button>
                    <button class="tab-btn" data-periodo="90">90 dias</button>
                    <button class="tab-btn" data-periodo="todos">Todos</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="chart-evolucao"></canvas>
            </div>
        </div>

        <!-- Detalhamento de Coletas -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 class="card-header" style="margin: 0;">Detalhamento de Coletas</h3>
                <button class="btn-primary" id="btn-exportar-coletas" style="padding: 6px 12px; font-size: 11px;">
                    Exportar CSV
                </button>
            </div>
            <div class="table-container">
                <table id="relatorio-table">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>ID</th>
                            <th>Local</th>
                            <th>Volume (KG)</th>
                            <th>KM</th>
                            <th>Parceiro</th>
                            <th>Tipo</th>
                            <th>Lucro/KG</th>
                        </tr>
                    </thead>
                    <tbody id="relatorio-tbody">
                        <tr>
                            <td colspan="8" style="text-align: center;">Carregando dados...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Right Panel -->
    <div class="relatorios-right-panel">
        <!-- Distribuição por Região -->
        <div class="card">
            <div class="chart-header">
                <h3 class="card-header">Distribuição por Região</h3>
                <div class="chart-controls">
                    <div class="control-group">
                        <span class="control-label">Orientação:</span>
                        <button type="button" class="chart-toggle-btn active" id="btn-orientacao-horizontal" data-orientacao="horizontal">
                            Horizontal
                        </button>
                        <button type="button" class="chart-toggle-btn" id="btn-orientacao-vertical" data-orientacao="vertical">
                            Vertical
                        </button>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Ordem:</span>
                        <button type="button" class="chart-toggle-btn active" id="btn-ordem-desc" data-ordem="desc">
                            Decrescente
                        </button>
                        <button type="button" class="chart-toggle-btn" id="btn-ordem-asc" data-ordem="asc">
                            Crescente
                        </button>
                    </div>
                </div>
            </div>
            <div class="chart-container-small">
                <canvas id="chart-distribuicao"></canvas>
            </div>
        </div>

        <!-- Top 5 Lixeiras -->
        <div class="card">
            <h3 class="card-header">Top 5 Lixeiras Mais Coletadas</h3>
            <div class="top-list" id="top-lixeiras">
                <p style="text-align: center; color: #7f8c8d; font-size: 12px;">Carregando...</p>
            </div>
        </div>

        <!-- Horários de Pico -->
        <div class="card">
            <h3 class="card-header">Horários de Pico</h3>
            <div class="chart-container-small">
                <canvas id="chart-horarios"></canvas>
            </div>
        </div>

        <!-- Resumo Executivo -->
        <div class="card">
            <h3 class="card-header">Resumo Executivo</h3>
            <div id="resumo-executivo">
                <div class="summary-box">
                    <div class="summary-title">Desempenho Geral</div>
                    <p id="resumo-desempenho">Selecione um período para ver o resumo.</p>
                </div>
                <div class="summary-box" style="margin-top: 10px;">
                    <div class="summary-title">Pontos de Atenção</div>
                    <p id="resumo-atencao">Nenhum ponto de atenção no período selecionado.</p>
                </div>
                <div class="summary-box" style="margin-top: 10px;">
                    <div class="summary-title">Recomendações</div>
                    <p id="resumo-recomendacoes">Analisando dados para gerar recomendações.</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="{{ url_for('static', filename='js/relatorios.js') }}"></script>
{% endblock %}
